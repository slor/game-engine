<html>
    <head>
        <title>Web Canvas</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <script src="../../build/bundle.js" type="text/javascript"></script>
    </head>

    <body>
        <div id="canvasContainer">
            <canvas id="screen" width="640" height="480">You do not support Canvas.</canvas>
        </div>
        <link rel="stylesheet" href="../style.css">
        <script type="text/javascript">
            game = new ge.Game(window);

            loader = new ge.Loader('http://localhost:8000/resources/10340.png', function (){
                const idle1 = new ge.Sprite(loader.sheet, game.context, 15, 11, 21, 44);
                const idle2 = new ge.Sprite(loader.sheet, game.context, 49, 11, 21, 44);
                const idle3 = new ge.Sprite(loader.sheet, game.context, 85, 11, 21, 44);

                const duck1 = new ge.Sprite(loader.sheet, game.context, 149, 11, 21, 44);
                const duck2 = new ge.Sprite(loader.sheet, game.context, 180, 11, 21, 44);
                const duck3 = new ge.Sprite(loader.sheet, game.context, 213, 11, 21, 44);

                let richtor = new ge.Entity(20, 20);
                richtor.registerAnimation('IDLE', [idle1, idle2, idle3, idle2], 1000 / 100, true)
                .registerAnimation('DUCK', [duck1, duck2, duck3], 1000 / 200)
                .registerState('IDLE', function(entity, world){
                    if(world.keysPressed['ArrowDown'] === true){
                        entity.state = 'DUCK';
                        return true;
                    }
                }, true)
                .registerState('DUCK', function(entity, world){
                    if(world.keysPressed['ArrowDown'] !== true){
                        entity.state = 'IDLE';
                        return true;
                    }
                });

                game.entities.push(richtor);

            }); 

            function loop(now){
                window.requestAnimationFrame(loop);

                game.frame(now);
            }

            window.addEventListener('keydown', function(e) {
                e = e || window.event;
                game.keyDown(e);
            });
            window.addEventListener('keyup', function(e) {
                e = e || window.event;
                game.keyUp(e);
            });
            
            window.requestAnimationFrame(loop);
        </script>
    </body>
</html>